<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <title>Hey Boss, Event Sourcing Can Fix That!</title>

    <meta name="description"
          content="Our application has so much going on! Slow page loads and a large legacy codebase make developers feel stuck between a rock and a hard place. In this session, we will explore a strategy to add a modern codebase alongside the legacy code, allowing them to run simultaneously until you replace it. We will discuss common legacy problems like complex database queries causing slow downs and large reports that take so long to load, users must wait instead of analyzing the data. As our system has grown, we may need to separate our application into distinct parts and pass relevant information between them. Or maybe we have two distinct codebases already and each codebase is affected by the other's changes in ways we didn't expect. We will examine how to add Event Sourcing and CQRS to these pain points and throw away that legacy spaghetti!">
    <meta name="author" content="Emily Stamey">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">

    <link rel="stylesheet" href="css/reveal.css">
    <link rel="stylesheet" href="css/theme/white.css">
    <link rel="stylesheet" href="css/my-style.css">

    <!-- Theme used for syntax highlighting of code -->
    <link rel="stylesheet" href="./node_modules/highlight.js/styles/zenburn.css">

    <link rel="icon" type="image/x-icon" href="favicon.ico" />

    <!--[if lt IE 9]>
    <script src="lib/js/html5shiv.js"></script>
    <![endif]-->

    <!--<link rel="stylesheet" href="plugin/accessibility/helper.css">-->

    <!-- Printing and PDF exports -->
    <script>
        var link = document.createElement( 'link' );
        link.rel = 'stylesheet';
        link.type = 'text/css';
        link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
        document.getElementsByTagName( 'head' )[0].appendChild( link );
    </script>
</head>
<body>
<div class="reveal">
    <div class="slides">
        <section>
            <myColBox>
                <article>
                    <h1 id="event-sourcing-can-fix-that-">Event Sourcing Can Fix That!</h1>
                </article>
            </myColBox>
        </section>
        <section>
            <myRowBox>
                <article>
                    <myColBox>
                        <article>
                            <img src="img/me.png" alt="developer">
                        </article>
                        <article>
                            <li>PHP developer</li>
                            <li>Organizer of Triangle PHP </li>
                            <li>Director WWCode Raleigh-Durham</li>
                            <li>Work at InQuest</li>
                            <p>&nbsp;</p>
                            <myColBox>
                                <article>
                                    <img src="img/WWCode_Logo_Raleigh_Durham.png">
                                </article>
                                <article>
                                    <img src="img/trianglePHP_sm.jpg">
                                </article>
                                <article>
                                    <img src="img/inquest.svg">
                                </article>
                            </myColBox>
                        </article>
                    </myColBox>
                </article>
            </myRowBox>
        </section>
        <section>
            <myTitleBox>
                <h3>Drago mi je sto sam ovde</h3>
            </myTitleBox>
            <myColBox>
                <article>
                    <img src="img/me.png" alt="Me">
                </article>
                <article>
                    <img src="img/Map_of_USA_NC.svg" alt="Map of US with NC highlighted">
                </article>
                <article>
                    <img src="img/mapfight-serbia-v-nc.png" alt="Map of NC and Serbia">
                </article>
            </myColBox>
            <aside class="notes">
                <li>drago me J sco sahm of day</li>
            </aside>
        </section>
        <!--<section>-->
            <!--<myColBox>-->
                <!--<article>-->
                    <!--<img src="img/family.png" alt="family">-->
                <!--</article>-->
            <!--</myColBox>-->
        <!--</section>-->
        <section>
            <myTitleBox>
                <h2 id="this-will-seem-like-overkill-for-a-little-bit">Before we begin</h2>
            </myTitleBox>
            <myColBox>
                <article>
                    <p>Switch from CRUD to Event-Sourcing is tough</p>
                    <p>Event-Sourcing isn't for your whole application</p>
                </article>
                <article>
                    <p><img src="img/library/look_here.gif"></p>
                </article>
            </myColBox>
            <aside class="notes">
                <li>Coming from a CRUD environment, Event-sourcing seems weird, it isn't normal to learn it all at once.  It can take a while!</li>
                <li>Reminder: As with all new things, be patient with yourself</li>
                <li>ES isn't for all the things!</li>
                <li>If we were simply managing inventory or building a blog app, we probably wouldn't need ES</li>
                <li>ES is helpful for they things that make our applications difficult to maintain over time, the changes in process</li>
                <li>ES is great for proving how you got to your results</li>
                <li>ES is powerful in that it's flexible to changes and keeping an audit log</li>
            </aside>
        </section>
        <section>
            <myTitleBox>
                <h1 id="we-re-going-to-talk-about-">Learning Objectives:</h1>
            </myTitleBox>
            <myColBox>
                <article>
                    <p>&nbsp;</p>
                    <ul>
                        <li>What is Event Sourcing
                            <ul>
                                <li>Rules to Follow</li>
                                <li>briefly describe the data structures: Events, Projections, Read Models, CQRS</li>
                            </ul>
                        </li>
                        <li>3 legacy projects that benefited from Event Sourcing</li>
                    </ul>
                </article>
            </myColBox>
        </section>
        <section>
            <myColBox>
                <article>
                    <h1 id="event-sourcing">Event Sourcing</h1>
                    <p>The fundamental idea of Event Sourcing is that of ensuring <strong>every change to the state</strong> of an application <strong>is captured in an event object</strong>, and that these event objects are themselves stored in the sequence they were applied for the same lifetime as the application state itself.</p></p>
                    <p>  Martin Fowler</p>
                </article>
            </myColBox>
        </section>
        <section>
            <myTitleBox>
                <h3>Events and Listeners</h3>
            </myTitleBox>
            <myColBox>
                <article>
                    <img src="img/library/events_listeners.png" alt="An Event represented as a diamond and a Listener represented as an ear">
                </article>
            </myColBox>
        </section>
        <section>
            <myTitleBox>
                <h3 id="an-event">An Event</h3>
            </myTitleBox>
            <myColBox>
                <article>
                    <p>What happened?<br>
                        <strong>BookWasCheckedOut</strong></p>
                    <p>What do I need to remember about it?<br>
                        <strong>(book, patron, date)</strong></p>
                </article>
            </myColBox>
        </section>
        <section>
            <myTitleBox>
                <h3 id="event-attributes">Attributes</h3>
            </myTitleBox>
            <myColBox>
                <article>
                    <ul>
                        <li>Save only what you need to preserve</li>
                        <li>The rest can be looked up</li>
                    </ul>
                    <p><strong>(book id, patron id, date)</strong></p>
                </article>
            </myColBox>
        </section>
        <section>
            <myTitleBox>
                <h3 id="rules-to-follow">Rules for Events</h3>
            </myTitleBox>
            <myColBox>
                <article>
                    <ul>
                        <li>Usually named as past-tense verbs</li>
                        <li><strong>RARELY</strong> changed</li>
                        <li><strong>Never</strong> deleted</li>
                        <li>Has attributes that are values<ul>
                            <li>not model, object, collection, or aggregate root</li>
                        </ul>
                        </li>
                    </ul>

                </article>
            </myColBox>
        </section>
        <section>
            <myColBox>
                <article>
                    <img src="img/status_change/dont_delete_events.png" alt="3 symbols representing events of a deposit, a correction, and a deposit">
                </article>
            </myColBox>
        </section>
        <section>
            <myTitleBox>
                <h3 id="don-t-store-objects">Don&#39;t store objects</h3>
            </myTitleBox>
            <myColBox>
                <article>
                    <img src="img/status_change/Objects.png" alt="objects can change">
                </article>
            </myColBox>
        </section>
        <section>
            <myTitleBox>
                <h3>If We Stored Objects in an Event...</h3>
            </myTitleBox>
            <myColBox>
                <article>
                    <img src="img/status_change/EventWithObject.png" alt="Event With Object">
                </article>
            </myColBox>
        </section>
        <section>
            <myTitleBox>
                <!--<h3 id="events-are-not-bionic">Events are not Bionic</h3>-->
            </myTitleBox>
            <myColBox>
                <article>
                    <img src="img/status_change/we_can_rebuild_him.jpg" alt="Events and Bionic Cat">
                </article>
            </myColBox>
        </section>
        <section>
            <myTitleBox>
                <h3 id="events-rarely-change">Events rarely change</h3>
            </myTitleBox>
            <myColBox>
                <article>
                    <ul>
                        <li>The part of the code that will change is most likely the <strong>result that follows that event</strong>.</li>
                        <li>The <strong>structure of the resulting data</strong> is more likely to change than the thing that happened</li>
                    </ul>
                </article>
            </myColBox>
        </section>
        <section>
            <myColBox>
                <article>
                    <p><img src="img/library/event_with_listener.png" alt="One event with one listener handling the event"></p>

                </article>
            </myColBox>
        </section>
        <section>
            <myColBox>
                <article>
                    <p><img src="img/status_change/events_replaced.png" alt="One event with two listeners handling the event differently, one is thrown away"></p>

                </article>
            </myColBox>
        </section>
        <section>
            <myColBox>
                <article>
                    <p><img src="img/status_change/events_treated_differently.png" alt="One event with two listeners handling the event differently"></p>

                </article>
            </myColBox>
        </section>
        <section>
            <myColBox>
                <article>
                    <h1 id="why-events-">Reasons to use Events</h1>
                    <ul>
                        <li>State transitions are important</li>
                        <li>We need an audit log, proof of the state we are currently in</li>
                        <li>The history of what happened is more important than the current state</li>
                        <li>Events are replayable if behavior in your application changes</li>
                    </ul>
                </article>
            </myColBox>
        </section>
        <section>
            <myColBox>
                <article>
                    <h1 id="event-class">Event Class</h1>
                    <pre><code>
&lt;?php

namespace Library\Events;

use Library\Support\Event;

class BookWasCheckedOut
{

    /**
     * @var DateTime
     */
    public $checkoutDate;

    /**
     * @var int
     */
    public $patronId;

    /**
     * @var int
     */
    public $bookId;

    public function __construct(DateTime $checkoutDate, PatronId $patronId, BookId $bookId)
    {

        $this-&gt;checkoutDate = $checkoutDate;
        $this-&gt;patronId = $patronId;
        $this-&gt;bookId = $bookId;
    }

    /**
    * @return array
    */
    public function serialize()
    {
        return [
            &#39;checkout_date&#39; =&gt; $this-&gt;$checkoutDate-&gt;toString(),
            &#39;patron_id&#39; =&gt; $this-&gt;patronId-&gt;toNative(),
            &#39;book_id&#39; =&gt; $this-&gt;bookId-&gt;toNative(),
        ];
    }

    /**
    * @param array $data
    *
    * @return static
    */
    public static function deserialize($data)
    {
        return new BookWasCheckedOut(
            DateTime::createFromFormat(&#39;j-M-Y&#39;, $data[&#39;checkout_date&#39;]),
            PatronId::fromNative($data[&#39;patron_id&#39;]),
            BookId::fromNative($data[&#39;book_id&#39;])
        );
    }
}
</code></pre>
                </article>
            </myColBox>
        </section>
        <section>
            <myTitleBox>
                <h3>Connecting the events</h3>
            </myTitleBox>
            <myRowBox>
                <article>
                    <ul>
                        <li><b>An event is created only after validation</b>
                            <ul>

                                <ul>
                                    <li>directly in a controller 'checkout' method</li>
                                    <li>using a Check Out Book Command and Handler</li>
                                </ul>
                            </ul>
                        </li>
                    </ul>
                </article>
            </myRowBox>
        </section>
        <section>
            <myColBox>
                <article>
                    <p><img src="img/status_change/DomainMessage.png" alt="Domain Message"></p>

                </article>
            </myColBox>
        </section>
        <section>
            <myTitleBox>
                <h3 id="event-store">Event Store</h3>
            </myTitleBox>
            <myColBox>
                <article>
                    <ul>
                        <li>Domain-specific database</li>
                        <li>Based on a Publish-Subscribe message pattern</li>
                    </ul>
                    <p><img src="img/status_change/EventStore.png" alt="EventStore"></p>

                </article>
            </myColBox>
        </section>
        <section data-background="img/status_change/projector.png">
            <aside class="notes">
                <p>A set of event handlers that work together to build and maintain a table to be accessed by the read model.</p>
            </aside>
        </section>
        <section>
            <myColBox>
                <article>
                    <h1 id="projector">Projector</h1>
                    <pre><code>&lt;?php

namespace Library\ReadModel;

use Library\Events\BookWasCheckedIn;
use Library\Events\BookAddedToBookshelf;
use App\Support\ReadModel\Replayable;
use App\Support\ReadModel\SimpleProjector;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Database\Connection;

class BookshelfProjector extends SimpleProjector implements Replayable
{

    /**
     * @var Connection
     */
    private $connection;

    /**
     * @var string table we&#39;re playing events into
     */
    private $table = &#39;proj_bookshelf&#39;;

    public function __construct(Connection $connection)
    {
        $this-&gt;connection = $connection;
    }

    public function beforeReplay()
    {
        $builder = $this-&gt;connection-&gt;getSchemaBuilder();

        $builder-&gt;dropIfExists(&#39;proj_bookshelf&#39;);
        $builder-&gt;create(&#39;proj_bookshelf_tmp&#39;, function (Blueprint $schema) {
            $schema-&gt;string(&#39;book_id&#39;);
            $schema-&gt;string(&#39;book_title&#39;);
            $schema-&gt;string(&#39;book_author&#39;);
            $schema-&gt;string(&#39;status&#39;);
            $schema-&gt;string(&#39;checkout_date&#39;);
            $schema-&gt;string(&#39;patron_id&#39;);

            $schema-&gt;primary(&#39;book_id&#39;);
        });

        $this-&gt;table = &#39;proj_bookshelf_tmp&#39;;
    }

    public function afterReplay()
    {
        $builder = $this-&gt;connection-&gt;getSchemaBuilder();

        $builder-&gt;dropIfExists(&#39;proj_bookshelf&#39;);
        $builder-&gt;rename(&#39;proj_bookshelf_tmp&#39;, &#39;proj_bookshelf&#39;);

        $this-&gt;table = &#39;proj_bookshelf&#39;;
    }

    /**
    * @param BookWasCheckedOut $event
    */
    public function applyBookWasCheckedOut(BookWasCheckedOut $event)
    {
        $bookshelfItem = BookshelfItem::where(&#39;id&#39;, $event-&gt;bookId);

        $book-&gt;status = &#39;Checked Out&#39;;
        $book-&gt;checkout_date = $event-&gt;checkoutDate;
        $book-&gt;patron_id = $event-&gt;patronId;

        $book-&gt;save();
    }

    /**
    * @param BookAddedToBookshelf $event
    */
    public function applyBookAddedToBookshelf(BookAddedToBookshelf $event)
    {
        $bookshelfItem = new BookshelfItem();
        $bookshelfItem-&gt;setTable($this-&gt;table);

        $bookshelfItem-&gt;bookId = $event-&gt;bookId;
        $bookshelfItem-&gt;bookTitle = $event-&gt;bookTitle;
        $bookshelfItem-&gt;bookAuthor = $event-&gt;bookAuthor;
        $bookshelfItem-&gt;status = &#39;on shelf&#39;;

        $bookshelfItem-&gt;save();
    }

}
</code></pre>

                    <p>A set of event handlers that work together to build and maintain a table to be accessed by the read model.</p>

                </article>
            </myColBox>
        </section>
        <section>
            <myTitleBox>
                <h1 id="read-model">Read Model</h1>
            </myTitleBox>
            <myColBox>
                <article>

                    <img src="img/library/read_model.png" alt="Read Model table with highlighted rows and queries">

                </article>
            </myColBox>
        </section>
        <section>
            <myColBox>
                <article>
                    <h1 id="read-model">Read Model</h1>
                    <pre><code>&lt;?php

namespace Library\ReadModel;


use Carbon\Carbon;
use Illuminate\Database\Eloquent\Model;

/**
* @codeCoverageIgnore
*/
class Bookshelf extends Model
{
    protected  $table = &#39;proj_bookshelf&#39;;
    public $incrementing = false;
    public $timestamps = false;

    public static function lookupLoansFor($patronId)
    {
        return static::where(&#39;patron_id&#39;, $patronId)-&gt;get();
    }

    public function lookupAvailableBooks()
    {
        return static::where(&#39;status&#39;, &#39;on shelf&#39;)-&gt;get();
    }

    public function lookupOverdueBooks()
    {
        return static::where(&#39;checkout_date&#39;, &#39;&lt;&#39;, date(&#39;Y-m-d&#39;, strtotime(&#39;-7 days&#39;)))-&gt;get();
    }
}
</code></pre>
                </article>
            </myColBox>
        </section>
        <!--<section>-->
        <!--<myTitleBox>-->
        <!--<h1>Aggregate Root</h1>-->
        <!--</myTitleBox>-->
        <!--<myRowBox>-->
        <!--<article>-->
        <!--<p>An aggregate root is an entity that is modeled using events. </p>-->
        <!--</article>-->
        <!--</myRowBox>-->
        <!--</section>-->
        <section data-background="img/library/interactionToEventDiagram.png">
            <!--<myColBox>-->
            <!--<article>-->
            <!--<p><img src="" alt="Diagram of the intearction on the web page then routed to the controller action, which calls a command, If valid, the Command creates the Event"></p>-->

            <!--</article>-->
            <!--</myColBox>-->
        </section>
        <section data-background="img/library/bookCheckoutForm.png">
        </section>
        <section>
            <myColBox>
                <article>
                    <h1 id="bookscontroller-update">CRUD: update</h1>
                    <pre><code>public function update(Request $request, $id)
{
    // our default update method
	// validate inputs
    $Book = Book::findOrFail($id);
    $Book-&gt;update($request-&gt;all());

    return $Book;
}
</code></pre>
                </article>
            </myColBox>
        </section>
        <section>
            <myTitleBox>
                <h1 id="crud-to-cqrs">CRUD Checkout</h1>
            </myTitleBox>
            <myColBox>
                <article>
                    <p>&nbsp;</p>
                    <pre><code>
public function checkOutBook(Request $request, $id)
{
    // altered the update method
	// validate inputs
    $Book = Book::findOrFail($id);
    $Book-&gt;update(&#39;status&#39; =&gt; &#39;checked out&#39;,
                    &#39;patron&#39; =&gt; $request-&gt;patronId);

    return $Book;
}
</code></pre>
                    <span class="fragment current-only" data-code-focus="2"></span>
                    <span class="fragment current-only" data-code-focus="7-8"></span>
                </article>
                <article>
                    <p>&nbsp;</p>
                    <p class="fragment"><img src="img/library/itDoesntFit.gif" alt="cat climbing into a trash pail but doesn&#39;t quite fit"></p>
                </article>
            </myColBox>
        </section>
        <section>
            <myTitleBox>
                <h1 id="crud-to-cqrs">CRUD Checkout</h1>
            </myTitleBox>
            <myColBox>
                <article>
                    <p>&nbsp;</p>
                    <pre><code>
public function checkOutBook(Request $request, $id)
{
    // altered the update method
    // validate book can be checked out

    $event = new BookWasCheckedOut($request->bookId,
				$request->patronId,
				time());

}
</code></pre>
                    <span class="fragment current-only" data-code-focus="5"></span>
                    <span class="fragment current-only" data-code-focus="7-9"></span>
                </article>
            </myColBox>
        </section>
        <section>
            <myRowBox>
                <article>
                    <h1 id="cqrs">CQRS</h1>
                    <p><strong>Command and Query Response Segregation</strong></p>
                    <ul>
                        <li><strong>Command</strong> is any method that mutates state</li>
                        <li><strong>Query</strong> is any method that returns a value</li>
                        <li>These methods become part of Services</li>
                        <li>When parts of your application no longer fit a CRUD model</li>
                        <li>Should only be used on specific portions of a system, not the system as a whole</li>
                    </ul>
                </article>
            </myRowBox>
        </section>
        <section>
            <myColBox>
                <article>
                    <h1 id="crud-to-cqrs">CRUD to CQRS</h1>
                    <pre><code>public function update(Request $request)
{
    // $request has book id, patron id

    try {

        $command = new CheckOutBook($request-&gt;bookId, $request-&gt;patronId);

        $this-&gt;bookLendingService-&gt;handleCheckOutBook($command);

    } catch (InvalidUserException $e) {
        return response()-&gt;json(&quot;Not authorized to request enrollment.&quot;, Response::HTTP_FORBIDDEN);
    } catch (BookUnavailableException $e) {
       return response()-&gt;json(&quot;Book was not available to be checked out&quot;, 400);


    return $Book;
}

&lt;------ dynamic command handler  ------&gt;

private function handle(Command $command)
{
    $method = $this-&gt;getHandleMethod($command);

    if (! method_exists($this, $method)) {
        return;
    }

    $this-&gt;$method($command);
}

private function getHandleMethod(Command $command)
{
    return &#39;handle&#39; . class_basename($command);
}

&lt;-------- handle check out book command ---------&gt;

public function handleCheckoutOutBook(CheckOutBook $command)
{
    $book = Book::findOrFail($command-&gt;bookId);
    $patron = Patron::findOrFail($command-&gt;patronId);

    if (!$book-&gt;isAvailable()) {
        throw new BookUnavailableException();
    }

    if (!$patron-&gt;isAuthorized()) {
        throw new InvalidUserException();
    }

    //record the event
    $this-&gt;record(
        new BookWasCheckedOut(date(&quot;Y-m-d H:i:s&quot;),
            $patron-&gt;getId(),
            $book-&gt;getId())
    );


}
</code></pre>
                    <span class="fragment current-only" data-code-focus="1"></span>
                    <span class="fragment current-only" data-code-focus="7"></span>
                    <span class="fragment current-only" data-code-focus="9"></span>
                    <span class="fragment current-only" data-code-focus="11-14"></span>
                    <span class="fragment current-only" data-code-focus="40"></span>
                    <span class="fragment current-only" data-code-focus="42-43"></span>
                    <span class="fragment current-only" data-code-focus="45-51"></span>
                    <span class="fragment current-only" data-code-focus="54-58"></span>
                </article>
            </myColBox>
        </section>
        <section>
            <myColBox>
                <article>
                    <h1 id="command-handler">Command Handler</h1>
                    <p>A command handler receives a command and brokers a result from the appropriate aggregate. &quot;A result&quot; is either a successful application of the command, or an exception.</p>
                    <p><strong> should affect one and only one aggregate </strong></p>
                    <!----- ** cannot call a read side** ----->
                </article>
            </myColBox>
        </section>
        <section>
            <myColBox>
                <article>
                    <h1 id="command-handler">Command Handler</h1>
                    <ol>
                        <li>Validate the command on its own merits.</li>
                        <li>Validate the command on the current state of the aggregate.</li>
                        <li>If validation is successful, create an event(s)</li>
                        <li>Attempt to persist the new events. If there&#39;s a concurrency conflict during this step, retry or exit.</li>
                    </ol>
                </article>
            </myColBox>
        </section>
        <section>
            <myColBox>
                <article>
                    <h1 id="separate-read-write">Optimize</h1>
                    <ul>
                        <li>all <strong>commands</strong> go into a WriteService</li>
                        <li>all <strong>queries</strong> go into a ReadService</li>
                        <li>to optimize your application for reads and writes</li>
                        <li>Separate the load from reads and writes allowing you to scale each independently. <ul>
                            <li><em>If your application sees a big disparity between reads and writes this is very handy.</em> </li>
                        </ul>
                        </li>
                        <li>Uses a separate model for all queries</li>
                    </ul>

                </article>
            </myColBox>
        </section>
        <section>
            <myColBox>
                <article>
                    <h1 id="task-based-ui">Task-based UI</h1>
                    <ul>
                        <li>Track what the user is doing and push forward commands representing the intent of the user </li>
                        <li>CQRS <strong>does not require</strong> a task based UI (DDD does)</li>
                        <li>CQRS used in a CRUD interface, makes creating separated data models harder</li>
                    </ul>

                </article>
            </myColBox>
        </section>

        <section>
            <myColBox>
                <article>
                    <h1 id="scholarships">Scholarships</h1>
                    <ul>
                        <li>replaced in pieces</li>
                        <li>added DDD &amp; ES &amp; CQRS beside complex framework spaghetti</li>
                        <li>separation of concerns</li>
                        <li>cleaner history and reports of what had been done</li>
                    </ul>
                </article>
            </myColBox>
        </section>
        <section>
            <myColBox>
                <article>
                    <img src="img/boots/scholarships_diagram.png" alt="Scholarships Project">
                </article>
            </myColBox>
        </section>
        <section>
            <myColBox>
                <article>
                    <img src="img/boots/knife_fork.jpg" alt="Fork Knife">
                </article>
            </myColBox>
        </section>
        <section>
            <myRowBox>
                <article>
                    <myColBox>
                        <article>
                            <img src="img/boots/octocat_Professortocat_v2.png" alt="github">
                        </article>
                        <article>
                            <img src="img/boots/vagrant-virtualbox.png" alt="virtualization">
                        </article>
                        <article>
                            <img src="img/boots/phpunit.png" alt="tests">
                        </article>
                    </myColBox>
                </article>
                <article>
                    <myColBox>
                        <article>
                            <img src="img/boots/logo-composer-transparent.png" alt="composer">
                        </article>
                        <article>
                            <img src="img/hey_boss/twig.jpg" alt="twig">
                        </article>
                        <article>
                            <img src="img/hey_boss/pimple.jpg" alt="pimple">
                        </article>
                    </myColBox>
                </article>
            </myRowBox>
        </section>
        <section>
            <myColBox>
                <article>
                    <img src="img/hey_boss/scholarships-filetree-legacy.png" alt="filetree old only">
                </article>
            </myColBox>
        </section>
        <section>
            <myColBox>
                <article>
                    <img src="img/boots/bounded_contexts.png" alt="bounded contexts">
                </article>
            </myColBox>
        </section>
        <section>
            <myColBox>
                <article>
                    <img src="img/hey_boss/scholarships-filetree.png" alt="filetree with new code">
                </article>
            </myColBox>
        </section>
        <section>
            <myColBox>
                <article>
                    <img src="img/hey_boss/scholarships-bounded-contexts-events.png" alt="bounded contexts with Events">
                </article>
            </myColBox>
        </section>
        <section>
            <myColBox>
                <article>
                    <img src="img/hey_boss/scholarships-filetree-controllers.png" alt="filetree with new controllers and views">
                </article>
            </myColBox>
        </section>
        <section>
            <myColBox>
                <article>
                    <h2 id="dependency-injection">Dependency Injection</h2>
                    <ul>
                        <li>add slide from bootstrapping through controllers and rearrange</li>
                    </ul>
                </article>
            </myColBox>
        </section>
        <section>
            <myColBox>
                <article>
                    <h2 id="legacy">Legacy</h2>
                    <ul>
                        <li>this was an example of replacing the code in pieces</li>
                        <li>could have replaced only one part or a few</li>
                        <li>really powerful to see which parts of your application could benefit from event sourcing</li>
                        <li>and finding the simplest way to implement</li>
                    </ul>
                </article>
            </myColBox>
        </section>
        <section>
            <myColBox>
                <article>
                    <h1 id="student-enrollment-process">Student Enrollment Process</h1>
                    <ul>
                        <li>rewrote</li>
                        <li>ES to follow the process</li>
                        <li>status drop-down versus events</li>
                    </ul>
                </article>
            </myColBox>
        </section>
        <section>
            <myColBox>
                <article>
                    <img src="img/hey_boss/inquest-logo-web.svg" alt="inquest logo">
                </article>
            </myColBox>
        </section>
        <section>
            <myColBox>
                <article>
                    <h1 id="diagram">Diagram</h1>
                    <p><img src="img/hey_boss/inquest-diagram.png" alt="diagram"></p>
                </article>
            </myColBox>
        </section>
        <section>
            <myColBox>
                <article>
                    <h1 id="session-threats-report">Session Threats Report</h1>
                    <ul>
                        <li>multiple daemons running parts of code and the UI consumes the results of the analysis<ul>
                        <li>complex DB queries</li>
                        <li>reports are slow to generate on-demand</li>
                    </ul>
                </article>
            </myColBox>
        </section>
        <section>
            <myColBox>
                <article>
                    <h2 id="event-sessiondiscovered">Event: SessionDiscovered</h2>
                    <ul>
                        <li>after validation to determine whether we have a valid session, we log a new event</li>
                    </ul>
                </article>
            </myColBox>
        </section>
        <section>
            <myColBox>
                <article>
                    <h3 id="new-sessiondiscovered-attributes-we-need-to-know-">new SessionDiscovered( attributes we need to know )</h3>

                </article>
            </myColBox>
        </section>
        <section>
        <myColBox>
        <article>
        <h2 id="event-sessiondiscovered">Event: SessionDiscovered</h2>
        <ul>
        <li>session id</li>
        <li>start time</li>
        <li>protocol</li>
        <li>source ip</li>
        <li>destination ip</li>
        <li>source port</li>
        <li>destination port</li>
        </ul>

        </article>
        </myColBox>
        </section>
        <section>
        <myColBox>
        <article>
        <h2 id="event-sessionscored">Event: SessionScored</h2>
        <ul>
        <li>session id</li>
        <li>threat contributor</li>
        <li>score</li>
        </ul>

        </article>
        </myColBox>
        </section>
        <section>
        <myColBox>
        <article>
        <h2 id="event-filescored">Event: FileScored</h2>
        <ul>
        <li>after validation that a file has matched a signature, we log a new event</li>
        </ul>
        <h3 id="new-filescored-attributes-we-need-to-know-">new FileScored( attributes we need to know )</h3>

        </article>
        </myColBox>
        </section>
        <section>
        <myColBox>
        <article>
        <h2 id="event-filescored">Event: FileScored</h2>
        <ul>
        <li>file id</li>
        <li>session id</li>
        <li>integration</li>
        <li>score</li>
        <li>signature that found it</li>
        </ul>

        </article>
        </myColBox>
        </section>
        <section>
        <myColBox>
        <article>
        <h2 id="event-filerescored">Event: FileRescored</h2>
        <ul>
        <li>after validation that a file has matched a signature and that it has been scored before\n- we log a new event</li>
        </ul>
        <h3 id="new-filerescored-attributes-we-need-to-know-">new FileRescored( attributes we need to know )</h3>

        </article>
        </myColBox>
        </section>
        <section>
        <myColBox>
        <article>
        <h2 id="event-filerescored">Event: FileRescored</h2>
        <ul>
        <li>file id</li>
        <li>session id</li>
        <li>integration</li>
        <li>new score</li>
        <li>signature that found it</li>
        </ul>

        </article>
        </myColBox>
        </section>
        <section>
        <myColBox>
        <article>
        <h2 id="projection-session">Projection: Session</h2>
        <ul>
        <li>listens for SessionDiscovered events<ul>
        <li>creates a new row in a table with the session details and a null score</li>
        </ul>
        </li>
        <li>listens for SessionScored events<ul>
        <li>finds the session in the table and updates the score and score contributor</li>
        </ul>
        </li>
        </ul>

        </article>
        </myColBox>
        </section>
        <section>
        <myColBox>
        <article>
        <h2 id="projection-report-for-top-threats-by-hash">Projection: Report for Top Threats by Hash</h2>
        <ul>
        <li>listens for FileScored and FileRescored Events<ul>
        <li>looks up details of file by the file id</li>
        <li>adds a row to table with <ul>
        <li>file id</li>
        <li>file md5 hash</li>
        <li>the filename</li>
        <li>file type</li>
        <li>the score</li>
        <li>signature that scored it</li>
        <li>source ip</li>
        <li>destination ip</li>
        <li>protocol</li>
        </ul>
        </li>
        </ul>
        </li>
        </ul>

        </article>
        </myColBox>
        </section>
        <section>
        <myColBox>
        <article>
        <h2 id="read-model-top-threats">Read Model: Top Threats</h2>
        <p>methods: </p>
        <ul>
        <li><p>top 10 threats by the file hash</p>
        <ul>
        <li>this excludes hits I&#39;m not allowed to see by the signature that did the scoring</li>
        <li>gets a current hit count of only the records I can see</li>
        </ul>
        </li>
        <li><p>top threats by file type</p>
        </li>
        <li>top threats by source/destination ip pairs</li>
        <li>top threats by protocol</li>
        </ul>

        </article>
        </myColBox>
        </section>
        <section>
        <myColBox>
        <article>
        <h2 id="good-stuff-">Good Stuff!</h2>
        <ul>
        <li>works well in our environment where we have multiple applications doing different things</li>
        <li>full audit log of what has happened in our environment</li>
        <li>the results of those events can be optimized for read to shorten the time to retrieve data</li>
        <li>separate the logic of what an event means based on context and purpose</li>
        <li>only display results that a user is allowed to see</li>
        <li>flexible to change, our interpretation of events can change, and we can rebuild projections without losing the full history</li>
        </ul>

        </article>
        </myColBox>
        </section>
        <section>
        <myColBox>
        <article>
        <h2 id="signatures">Signatures</h2>
        <ul>
        <li>history of changes</li>
        <li>past scores/score history</li>
        </ul>

        </article>
        </myColBox>
        </section>
        <section>
        <myColBox>
        <article>
        <h2 id="rescans-and-history-from-rescans">Rescans and history from rescans</h2>
        <ul>
        <li>what can we see?</li>
        </ul>

        </article>
        </myColBox>
        </section>
        <section>
        <myColBox>
        <article>
        <h2 id="efficiency">Efficiency</h2>
        <ul>
        <li>With events written, can process them for multiple contexts</li>
        <li>Speed up scans by delaying the writes to the report</li>
        <li>Speed up reports by building from events/optimized for read</li>
        </ul>

        </article>
        </myColBox>
        </section>
        <section>
            <myColBox>
                <article>
                    <h1 id="thank-you">много вам хвала</h1>
                    <img src="img/phpsrbija-logo.png" alt="php srbija" style="background-color: #1a6091">
                </article>
            </myColBox>
            <aside class="notes">
                <li>hvala sto ste me primili</li>
                <li>hvala shto shtay may pree-mily</li>
            </aside>
        </section>
        <section>
            <myColBox>
                <article>
                    <div class="author">
                        <h1 class="name">Emily Stamey</h1>
                        <h3 class="twitter">
                        <a href="http://twitter.com/@elstamey">@elstamey</a>
                        </h3>
                        <h3 class="url">
                        <a href="http://elstamey.com">http://elstamey.com</a>
                        </h3>
                    </div>
                </article>
            </myColBox>
        </section>

    </div>
</div>

<script src="lib/js/head.min.js"></script>
<script src="js/reveal.js"></script>

<script>
    // More info https://github.com/hakimel/reveal.js#configuration
    Reveal.initialize({
        history: true,

        // More info https://github.com/hakimel/reveal.js#dependencies
        dependencies: [
            { src: 'plugin/markdown/marked.js' },
            { src: 'plugin/markdown/markdown.js' },
            { src: 'plugin/notes/notes.js', async: true },
            { src: 'node_modules/highlight.js/lib/highlight.js' },
//					{ src: 'plugin/accessibility/helper.js', async: true, condition: function() {
//						return !!document.body.classList;
//					}},
            {
                src: 'node_modules/reveal-code-focus/reveal-code-focus.js',
                async: true,
                callback: function() {
                    RevealCodeFocus();
                }
            },
            { src: 'plugin/elapsed-time-bar/elapsed-time-bar.js'}
        ],

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1280,
        height: 720,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        // Bounds for smallest/largest possible scale to apply to content
        minScale: 0.2,
        maxScale: 1.5,


        // your allotted time for presentation
        allottedTime: 50 * 60 * 1000, // 50 minutes

        // - (optional) height of page/time progress bar
        progressBarHeight: 3,

        // - (optional) bar color
        barColor: 'rgb(200,0,0)',

        // - (optional) bar color when timer is paused
        pausedBarColor: 'rgba(200,0,0,.6)',

        // Display controls in the bottom right corner
        controls: true,

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: Reveal.navigateNext,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // Hides the address bar on mobile devices
        hideAddressBar: true,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style
        transition: 'none', // none/fade/slide/convex/concave/zoom

        // Transition speed
        transitionSpeed: 'default', // default/fast/slow

        // Transition style for full page slide backgrounds
        backgroundTransition: 'none', // none/fade/slide/convex/concave/zoom

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Parallax background image
        parallaxBackgroundImage: '', // e.g. "'https://s3.amazonaws.com/hakim-static/reveal-js/reveal-parallax-1.jpg'"

        // Parallax background size
        parallaxBackgroundSize: '', // CSS syntax, e.g. "2100px 900px"

        // Number of pixels to move the parallax background per slide
        // - Calculated automatically unless specified
        // - Set to 0 to disable movement along an axis
        parallaxBackgroundHorizontal: null,
        parallaxBackgroundVertical: null,

        pdfMaxPagesPerSlide: 1,

        // Value of the display CSS property applied to current slide to make it visible
        display: 'flex',

        keyboard: {
            // pause/resume time when Enter is pressed
            13: () => {
            ElapsedTimeBar.isPaused ? ElapsedTimeBar.resume() : ElapsedTimeBar.pause();
    },

    // reset timer when 'r' is pressed
    82: () => {
        ElapsedTimeBar.reset();
    }
    }
    })
</script>
</body>
</html>